# ä¸‹ä¸€æ­¥æ“ä½œæ¸…å•

## ğŸ“Š å½“å‰çŠ¶æ€

- âœ… Docker å·²å®‰è£…ï¼ˆ26.1.3ï¼‰
- âœ… Docker Compose å·²å®‰è£…ï¼ˆ1.25.0ï¼‰
- âœ… nvidia-docker2 å·²å®‰è£…ï¼ˆGPU æ”¯æŒï¼‰
- âš ï¸ ç”¨æˆ·æƒé™æœªé…ç½®ï¼ˆéœ€è¦ sudoï¼‰
- âš ï¸ é•œåƒåŠ é€Ÿæœªå®Œå…¨é…ç½®ï¼ˆåªæœ‰ nvidia runtimeï¼Œç¼ºå°‘ registry-mirrorsï¼‰
- â³ é•œåƒå°šæœªæ„å»º
- â³ å®¹å™¨å°šæœªè¿è¡Œ

---

## ğŸš€ ç«‹å³æ‰§è¡Œçš„æ­¥éª¤

### æ­¥éª¤ 1ï¼šé…ç½®ç”¨æˆ·æƒé™ï¼ˆçº¦ 1 åˆ†é’Ÿï¼Œæ¨èï¼‰

é¿å…æ¯æ¬¡ä½¿ç”¨ `sudo`ï¼š

```bash
sudo usermod -aG docker $USER
newgrp docker  # æˆ–é‡æ–°ç™»å½•

# éªŒè¯ï¼ˆä¸éœ€è¦ sudoï¼‰
docker ps
```

### æ­¥éª¤ 2ï¼šå®Œå–„é•œåƒåŠ é€Ÿé…ç½®ï¼ˆçº¦ 2 åˆ†é’Ÿï¼Œæ¨èï¼‰

æ·»åŠ å›½å†…é•œåƒæºï¼ŒåŠ é€Ÿé•œåƒæ‹‰å–ï¼š

```bash
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "runtimes": {
    "nvidia": {
      "path": "nvidia-container-runtime",
      "runtimeArgs": []
    }
  },
  "registry-mirrors": [
    "https://docker.mirrors.ustc.edu.cn",
    "https://hub-mirror.c.163.com",
    "https://mirror.baidubce.com"
  ]
}
EOF

sudo systemctl restart docker

# éªŒè¯é…ç½®
cat /etc/docker/daemon.json
```

### æ­¥éª¤ 3ï¼šå¼€å§‹æ„å»º Docker é•œåƒï¼ˆ30-60 åˆ†é’Ÿï¼‰

**é‡è¦**ï¼šè¿™æ˜¯é¦–æ¬¡æ„å»ºï¼Œä¼šå»ºç«‹ç¼“å­˜ï¼Œåç»­ä¿®æ”¹ä»£ç åé‡æ–°æ„å»ºä¼šå¿«å¾ˆå¤šã€‚

```bash
cd /root/TFG_ui

# å¼€å§‹æ„å»ºï¼ˆå»ºè®®åœ¨ screen æˆ– tmux ä¸­è¿è¡Œï¼Œé¿å…æ–­çº¿ï¼‰
docker build -t tfg_ui:latest -f Dockerfile .

# æˆ–è€…ä½¿ç”¨ screenï¼ˆæ¨èï¼Œé¿å… SSH æ–­å¼€å¯¼è‡´æ„å»ºä¸­æ–­ï¼‰
screen -S docker_build
docker build -t tfg_ui:latest -f Dockerfile .
# æŒ‰ Ctrl+A ç„¶å D å¯ä»¥ detachï¼Œç”¨ screen -r docker_build é‡æ–°è¿æ¥
```

**æ„å»ºæ—¶é—´**ï¼š
- é¦–æ¬¡æ„å»ºï¼š30-60 åˆ†é’Ÿï¼ˆæ‰€æœ‰å±‚éƒ½éœ€è¦æ„å»ºï¼‰
- ä»£ç ä¿®æ”¹åï¼š5-15 åˆ†é’Ÿï¼ˆå¤ç”¨ç¯å¢ƒç¼“å­˜ï¼‰

**æ„å»ºè¿‡ç¨‹ä¸­**ï¼š
- ä¼šä¸‹è½½åŸºç¡€é•œåƒï¼ˆCUDA 11.8ï¼‰
- ä¼šå®‰è£…ç³»ç»Ÿä¾èµ–
- ä¼šå®‰è£… Miniconda
- ä¼šåˆ›å»º 4 ä¸ª conda ç¯å¢ƒï¼ˆtalking_gaussian, cosyvoice, tg_eval, tg_niqeï¼‰
- ä¼šç¼–è¯‘ CUDA æ‰©å±•æ¨¡å—ï¼ˆdiff-gaussian-rasterization, simple-knn, gridencoderï¼‰

### æ­¥éª¤ 4ï¼šéªŒè¯é•œåƒæ„å»ºæˆåŠŸ

```bash
# æŸ¥çœ‹é•œåƒ
docker images | grep tfg_ui

# åº”è¯¥çœ‹åˆ°ï¼š
# tfg_ui  latest  <image_id>  <time>  <size>
```

### æ­¥éª¤ 5ï¼šè¿è¡Œå®¹å™¨æµ‹è¯•ï¼ˆçº¦ 1 åˆ†é’Ÿï¼‰

```bash
# ä½¿ç”¨ docker-composeï¼ˆæ¨èï¼‰
docker compose up -d

# æˆ–ä½¿ç”¨ docker å‘½ä»¤
docker run -d \
  --name tfg_ui \
  --gpus all \
  -p 5001:5001 \
  -v $(pwd)/static:/app/static \
  -v $(pwd)/TalkingGaussian/data:/app/TalkingGaussian/data \
  -v $(pwd)/TalkingGaussian/output:/app/TalkingGaussian/output \
  -v $(pwd)/backend/config:/app/backend/config \
  tfg_ui:latest
```

### æ­¥éª¤ 6ï¼šéªŒè¯è¿è¡Œ

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps

# æŸ¥çœ‹æ—¥å¿—
docker logs tfg_ui
# æˆ–
docker compose logs -f

# è®¿é—®åº”ç”¨
curl http://localhost:5001
# æˆ–åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼šhttp://<æœåŠ¡å™¨IP>:5001
```

---

## ğŸ“‹ å®Œæ•´æ“ä½œå‘½ä»¤ï¼ˆå¤åˆ¶ç²˜è´´æ‰§è¡Œï¼‰

```bash
# ==========================================
# æ­¥éª¤ 1ï¼šé…ç½®ç”¨æˆ·æƒé™
# ==========================================
sudo usermod -aG docker $USER
newgrp docker

# ==========================================
# æ­¥éª¤ 2ï¼šå®Œå–„é•œåƒåŠ é€Ÿé…ç½®
# ==========================================
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "runtimes": {
    "nvidia": {
      "path": "nvidia-container-runtime",
      "runtimeArgs": []
    }
  },
  "registry-mirrors": [
    "https://docker.mirrors.ustc.edu.cn",
    "https://hub-mirror.c.163.com",
    "https://mirror.baidubce.com"
  ]
}
EOF
sudo systemctl restart docker

# ==========================================
# æ­¥éª¤ 3ï¼šå¼€å§‹æ„å»ºé•œåƒï¼ˆå»ºè®®ä½¿ç”¨ screenï¼‰
# ==========================================
cd /root/TFG_ui

# å®‰è£… screenï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
sudo apt-get install -y screen

# å¯åŠ¨ screen ä¼šè¯
screen -S docker_build

# åœ¨ screen ä¸­æ„å»ºé•œåƒ
docker build -t tfg_ui:latest -f Dockerfile .

# æŒ‰ Ctrl+A ç„¶å D å¯ä»¥ detachï¼ˆæ„å»ºç»§ç»­åœ¨åå°è¿è¡Œï¼‰
# ç”¨ screen -r docker_build é‡æ–°è¿æ¥æŸ¥çœ‹è¿›åº¦

# ==========================================
# æ­¥éª¤ 4ï¼šæ„å»ºå®Œæˆåï¼Œè¿è¡Œå®¹å™¨
# ==========================================
docker compose up -d

# ==========================================
# æ­¥éª¤ 5ï¼šéªŒè¯è¿è¡Œ
# ==========================================
docker ps
docker logs tfg_ui
curl http://localhost:5001
```

---

## â±ï¸ æ—¶é—´ä¼°ç®—

| æ­¥éª¤ | æ—¶é—´ | è¯´æ˜ |
|-----|------|------|
| é…ç½®æƒé™ | 1 åˆ†é’Ÿ | å¿«é€Ÿé…ç½® |
| é…ç½®é•œåƒåŠ é€Ÿ | 2 åˆ†é’Ÿ | å¿«é€Ÿé…ç½® |
| **é¦–æ¬¡æ„å»ºé•œåƒ** | **30-60 åˆ†é’Ÿ** | âš ï¸ æœ€è€—æ—¶ï¼Œå»ºè®®åœ¨ screen ä¸­è¿è¡Œ |
| è¿è¡Œå®¹å™¨ | 1 åˆ†é’Ÿ | å¿«é€Ÿå¯åŠ¨ |
| éªŒè¯è¿è¡Œ | 1 åˆ†é’Ÿ | å¿«é€ŸéªŒè¯ |

**æ€»è®¡**ï¼šçº¦ 35-65 åˆ†é’Ÿï¼ˆä¸»è¦æ˜¯æ„å»ºé•œåƒçš„æ—¶é—´ï¼‰

---

## ğŸ’¡ é‡è¦æç¤º

### 1. ä½¿ç”¨ screen é¿å…æ–­çº¿

æ„å»ºé•œåƒéœ€è¦ 30-60 åˆ†é’Ÿï¼Œå¦‚æœ SSH æ–­å¼€ä¼šå¯¼è‡´æ„å»ºä¸­æ–­ã€‚å»ºè®®ä½¿ç”¨ `screen`ï¼š

```bash
# å¯åŠ¨ screen
screen -S docker_build

# åœ¨ screen ä¸­è¿è¡Œæ„å»ºå‘½ä»¤
docker build -t tfg_ui:latest -f Dockerfile .

# æŒ‰ Ctrl+A ç„¶å D å¯ä»¥ detachï¼ˆæ„å»ºç»§ç»­è¿è¡Œï¼‰
# ç”¨ screen -r docker_build é‡æ–°è¿æ¥
```

### 2. æ„å»ºè¿‡ç¨‹ä¸­çš„æ³¨æ„äº‹é¡¹

- **ç½‘ç»œè¿æ¥**ï¼šç¡®ä¿ç½‘ç»œç¨³å®šï¼Œæ„å»ºè¿‡ç¨‹ä¸­éœ€è¦ä¸‹è½½å¤§é‡ä¾èµ–
- **ç£ç›˜ç©ºé—´**ï¼šç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼ˆè‡³å°‘ 50GBï¼‰
- **è€å¿ƒç­‰å¾…**ï¼šé¦–æ¬¡æ„å»ºéœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œè¿™æ˜¯æ­£å¸¸çš„
- **æŸ¥çœ‹è¿›åº¦**ï¼šå¯ä»¥ä½¿ç”¨ `docker build --progress=plain` æŸ¥çœ‹è¯¦ç»†è¿›åº¦

### 3. å¦‚æœæ„å»ºå¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
docker build --progress=plain -t tfg_ui:latest -f Dockerfile . 2>&1 | tee build.log

# æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
cat build.log | tail -50
```

---

## ğŸ¯ ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»åšï¼‰

1. âœ… **å¼€å§‹æ„å»ºé•œåƒ** - è¿™æ˜¯æ ¸å¿ƒä»»åŠ¡ï¼Œéœ€è¦ 30-60 åˆ†é’Ÿ
2. âœ… **é…ç½®é•œåƒåŠ é€Ÿ** - æå‡æ„å»ºé€Ÿåº¦ï¼Œé¿å…ç½‘ç»œé—®é¢˜

### ä¸­ä¼˜å…ˆçº§ï¼ˆæ¨èåšï¼‰

3. âš ï¸ **é…ç½®ç”¨æˆ·æƒé™** - æ–¹ä¾¿åç»­æ“ä½œï¼Œé¿å…æ¯æ¬¡ä½¿ç”¨ sudo

### ä½ä¼˜å…ˆçº§ï¼ˆå¯é€‰ï¼‰

4. â³ **è¿è¡Œå®¹å™¨æµ‹è¯•** - æ„å»ºå®Œæˆåå†åš
5. â³ **éªŒè¯åŠŸèƒ½** - è¿è¡Œåå†åš

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- `DOCKERå®Œæ•´æŒ‡å—.md` - å®Œæ•´çš„ Docker ä½¿ç”¨æ–‡æ¡£
- `TalkingGaussian/evaluation/è¯„æµ‹æµç¨‹è¯´æ˜.md` - è¯„æµ‹åŠŸèƒ½è¯´æ˜

---

## âœ¨ æ€»ç»“

**ç°åœ¨æœ€éœ€è¦åšçš„äº‹æƒ…**ï¼š

1. **é…ç½®é•œåƒåŠ é€Ÿ**ï¼ˆ2 åˆ†é’Ÿï¼‰
2. **å¼€å§‹æ„å»ºé•œåƒ**ï¼ˆ30-60 åˆ†é’Ÿï¼Œå»ºè®®åœ¨ screen ä¸­è¿è¡Œï¼‰

æ„å»ºå®Œæˆåï¼Œå°±å¯ä»¥è¿è¡Œå®¹å™¨å¹¶æµ‹è¯•ç³»ç»Ÿäº†ï¼

ç¥ä½ æ„å»ºé¡ºåˆ©ï¼ğŸ‰

